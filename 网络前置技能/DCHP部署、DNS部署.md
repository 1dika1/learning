### DCHP部署与安全

##### 作用

（Dynamic host configure protocol）自动分配IP地址

##### DHCP相关概念

地址池/作用域：（ip，子网掩码，网关，DNS，租期）

***协议端口是UDP 67，68***

##### DHCP优点

减少工作量

避免ip冲突

提高地址利用率

##### DHCP原理

也称为DHCP租约过程，分为4个步骤

1. 客户机发送DHCP Discovery广播包

   客户机广播请求IP地址（包含客户机的MAC地址）

2. 服务器响应DHCP Offer广播包

   服务器响应提供的IP地址（但无子网掩码、网关等参数）

3. 客户机发送DHCP Request广播包

   客户机选择IP（也可认为确认使用哪个IP）

4. 服务器发送DHCP ACK广播包

   服务器确认租约、并提供网卡详细参数IP、掩码、网关、DNS、租期等

##### DHCP续约

​		50%过后，客户机会***再次发送DHCP Request包***（第二次），进行续约，如果服务器无响应，则继续使用并在87.5%，***再次发送DCHP Request包***（第三次），进行续约，如服务器仍然无响应，并释放IP地址，及重新发送DHCP Discovery 广播包来获取IP地址，当无任何服务器响应时，自动给自己分配一个***169.254.x.x/16***，全球同意无效地址，用于临时内网通信！

##### 部署DHCP服务器

###### 步骤

1. IP地址固定（服务器必须有一个固定的ip地址）
2. 安装dhcp服务插件
3. 新建作用域以及作用域选项
4. 激活

###### 客户机验证

```
ipconfig  /release  #手动释放ip地址（取消租约）

ipconfig /renew      #重新获取IP（有IP时，发送Request续约，无IP时，发送Discovery重新获取）
```

##### 地址保留

对指定的MAC地址，固定动态分配IP地址

->作用域下的保留选项

##### 选项优先级

作用域选项>服务器选项

当服务器上有多个作用域时，可以在服务器选项上设置DNS服务器(所有的作用域都会继承DNS服务器)

##### DHCP备份与还原

右键点击备份/还原

##### DHCP攻击与防御

1. 攻击DHCP服务器：频繁地发送伪装DHCP请求，直到将DHCP地址池资源耗尽

   防御：在交换机（管理型）的端口上做动态MAC地址绑定

2. 伪装DHCP服务器攻击：hack把自己部署成DHCP服务器，为客户机提供非法ip地址

   防御：在交换机上，除了合法的DHCP服务器所在接口外，全部设置为静止发送请求

### DNS部署与安全

##### DNS

Domain Name Service

域名服务

作用：为客户机提供域名解析服务

##### 域名组成

”主机名.域名“称为完全限定域名（FQDN），一个域名可以有多个主机，域名全球唯一

##### 监听端口

```
TCP 53

UDP 53
```



##### DNS解析种类

###### 按查询方式

递归：客户机和本地DNS服务器之间

迭代：本地DNS服务器与根等其他DNS服务器的解析过程   

###### 按查询内容

正向解析：已知域名，解析IP地址

反向解析：已知IP地址，解析域名

##### DNS服务器搭建过程

```
ipconfig /flushdns    #清空本地缓存dns

ipconfig /displaydns   #查看本地缓存dns
```

